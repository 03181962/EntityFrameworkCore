queue:
  name: Hosted VS2017
  timeoutInMinutes: 60
steps:
- checkout: self
  clean: true
- script: .\build.cmd -ci /bl:artifacts/logs/build.binlog
  timeoutInMinutes: 55
- task: PublishBuildArtifacts@1
  displayName: Upload binlog
  condition: always()
  inputs:
    artifactName: binlog
    artifactType: Container
    pathtoPublish: artifacts/logs/build.binlog
- powershell: |
   $all_Processes = gwmi win32_process -ComputerName . | select ProcessID,ParentProcessID,Description,@{l="Username";e={$_.getowner().user}},CommandLine | where{$_.Username -like $env:username}
   write-host -f Magenta "------All------"
   $all_Processes
   $all_processIDs = $all_Processes.Processid
   $parent_processIDs = $all_Processes.ParentProcessId
   $gone = New-Object System.Collections.ArrayList
   $parent_processIDs | Sort-Object -Unique | ForEach-Object {
       if ($all_processIDs -notcontains $_)
       {
           $gone.Add($_) | Out-Null
       }
   }
   write-host -f Magenta "------Orphaned------"
   $all_Processes | Where-Object {$gone -contains $_.ParentProcessId} | ForEach-Object {$_}
  displayName: List orphan processes
  condition: always()
